// prisma/sqlite/schema.prisma
generator client {
  provider = "prisma-client-js"
  output   = "../../src/lib/db/generated/sqlite"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Batch {
  id             String   @id
  createdAtUtc   DateTime @default(now())
  windowStartUtc DateTime
  windowEndUtc   DateTime

  status String // "running" | "success" | "failed"
  error  String?

  gdeltQuery         String
  gdeltUrl           String
  articleCount       Int
  europeArticleCount Int

  supplementLinksText String? // CryptoPanic links JSON string (MVP 鍙┖)

  cards    TopicCard[]
  articles IngestedArticle[]
}

model TopicCard {
  id           String   @id @default(cuid())
  createdAtUtc DateTime @default(now())

  batchId    String
  rank       Int
  score      Float
  clusterKey String

  // 涓ユ牸 JSON 鐨勫瓧绗︿覆鍖栫粨鏋滐紙SQLite 涓嶆敮鎸?Json 绫诲瀷锛屾墍浠ュ瓨 TEXT锛?  cardJsonText String

  batch Batch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@unique([batchId, rank])
}

model IngestedArticle {
  id           String   @id @default(cuid())
  createdAtUtc DateTime @default(now())

  batchId String

  url           String
  urlCanonical  String
  title         String
  excerpt       String?
  domain        String?
  sourceCountry String?
  language      String?

  seenDateUtc DateTime?

  rawJsonText String

  batch Batch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@unique([batchId, urlCanonical])
}

